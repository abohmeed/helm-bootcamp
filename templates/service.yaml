apiVersion: v1
kind: Service
metadata:
    name: {{ .Release.Name }}-my-service
    {{- if .Values.service.labels}}
    labels:
      {{- with .Values.service.labels }}
        environment: {{ .environment}}
        application: {{ .application }}
        {{- end }}
    {{- end }}
    annotations:
      {{- range .Values.service.annotations }}
      {{ .name }}: "{{ .value }}"
      {{- end }}
spec:
    selector:
        app: helloworld
    ports:
        {{- if .Values.service.https }}
          {{- with .Values.service }}
        - name: https
          protocol: TCP
          port: {{ .https.port }}
          targetPort: 443
        {{- else }}
        - name: http
          protocol: TCP
          port: {{ .http.port }}
          targetPort: 80
          {{- end }}
        {{- end }}